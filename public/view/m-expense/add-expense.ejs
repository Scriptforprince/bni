<!-- header -->
<%- include('../partials/header') %>
  <!-- end header -->

  <!-- sidebar -->

  <%- include('../partials/chapter-sidebar') %>

    <!-- end sidebar -->
    <style>
      /* Ensuring that the modal body has padding */
      .modal-body {
        padding: 20px;
      }

      /* Preventing the add button container from affecting layout */
      .add-button-container {
        margin-top: 10px;
        /* Space above the button */
        display: none;
        /* Initially hidden */
      }
    </style>
    <style>
      .custom-dropdown {
        position: relative;
        cursor: pointer;
        border: 1px solid #ccc;
        padding: 10px;
        border-radius: 5px;
      }

      .options {
        display: none;
        position: absolute;
        border: 1px solid #ccc;
        background: white;
        width: 100%;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1;
      }

      .options div {
        padding: 10px;
        display: flex;
        align-items: center;
      }

      .options div:hover {
        background-color: #f0f0f0;
      }

      .selected {
        display: flex;
        align-items: center;
      }
    </style>

    <!-- Start::app-content -->
    <div class="main-content app-content" style="background-color: #f4f4f4">
      <div class="container-fluid">
        <!-- Start::page-header -->
        <div class="d-flex align-items-center justify-content-between page-header-breadcrumb flex-wrap gap-2">
          <div>
            <h1 class="page-title fw-medium fs-18 mb-0">
              <span style="font-weight: 700; font-family: Poppins">Add New Expense</span>
            </h1>
            <!-- <p>Manage kitty payments with just one click</p> -->
          </div>

        </div>
        <!-- End::page-header -->
        <style>
          @import url("https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap");

          @import url("https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
        </style>

        <style>
          * {
            font-family: Montserrat !important;
            font-weight: 800px;
          }

          .text-muted {
            color: black !important;
            font-family: Montserrat Alternates;
          }

          .popins {
            font-family: Poppins;
          }
        </style>

        <form id="addExpenseForm">
          <div class="row">
            <div class="col-xl-12">
              <div class="card custom-card">
                <div class="card-body add-products">
                  <div class="row gx-4">
                    <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-6">
                      <div class="card custom-card shadow-none mb-0 border-0">
                        <div class="card-body p-0">
                          <div class="row gy-3">
                            <div class="col-xl-12">
                              <label for="product-cost-add" class="form-label">
                             
                                <span style="font-size: 15px">
                                  <b>It's time to add a new expense!</b>
                                </span>
                             
                              </label>
                              <button
                              class="btn btn-danger border"
                              type="button"
                              id="addNewExpenseBtn"
                              data-region-id="123" 
                              style="float: right"
                            >
                              + Add New Expense
                            </button> 
                            </div>

                            <div class="col-xl-6">
                              <label for="expense_type" class="form-label">Type of Expense</label>
                              <select class="form-control" name="expense_type" id="expense_type">
                                <option value="">Loading...</option>
                              </select>
                            </div>
                            <div class="col-xl-6">
                              <label for="submitted_by" class="form-label">Submitted By:</label>
                              <input type="text" class="form-control" id="submitted_by" name="submitted_by"
                                placeholder="Enter Name" maxlength="50" />
                            </div>

                            <div class="col-xl-6">
                              <label for="description" class="form-label">Description</label>
                              <textarea class="form-control" id="description" name="description"
                                placeholder="Enter description" rows="3" maxlength="200"></textarea>
                            </div>
                            </br>
                            <div id="membershipFeesContainer" class="container">
                              </br>
                              <div class="row">
                                <div class="col-xl-4 col-md-4">
                                  <label class="form-label" for="amount">Amount</label>
                                  <input type="text" class="form-control" id="amount" name="amount"
                                    placeholder="Enter Amount" value="" maxlength="10" />
                                </div>

                                <div class="col-xl-4 col-md-4">
                                  <label for="payment_status" class="form-label">Payment Status</label>
                                  <select class="form-control" name="payment_status" id="payment_status">
                                    <option value="">Payment Status</option>
                                    <option value="paid">Paid</option>
                                    <option value="pending">Pending</option>
                                  </select>
                                </div>
                                <div class="col-xl-4 col-md-4">
                                  <label for="bill_date" class="form-label">Bill Date:</label>
                                  <input type="date" id="bill_date" name="bill_date" class="form-control" />
                                </div>
                              </div>
                              </br>
                              <div class="row">
                                <div class="col-xl-4">
                                  <label for="upload_bill" class="form-label">Upload Bill</label>
                                  <input type="file" class="form-control" id="upload_bill" name="upload_bill" />
                                </div>
                                <div class="col-xl-4">
                                  <label for="upload_bill" class="form-label">Bill No.</label>
                                  <input type="text" class="form-control" id="bill_no" name="bill_no"  placeholder="Enter Bill No." maxlength="20"/>
                                </div>
                                <div class="col-xl-4">
                                  <label for="transaction_no" class="form-label">Transaction No.</label>
                                  <input type="text" class="form-control" id="transaction_no" name="transaction_no"
                                    placeholder="Enter Transaction No" maxlength="20" />
                                </div>
                              </div>
                              </br>
                              <button type="button" id="addExpenseButton" class="btn btn-success me-2 mb-2 mb-sm-0">
                                Add Expense
                              </button>
                            </div>
                          </div>
                        </div>

                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
        <div id="formMessage"></div>
      </div>
    </div>
    <!-- End::content  -->

    <script>
     document.addEventListener("DOMContentLoaded", function () {
  // Fetch data for "Type of Expense"
  fetch("https://bni-data-backend.onrender.com/api/expenseType")
    .then((response) => response.json())
    .then((data) => {
      console.log("Expense Types:", data);
      const expenseTypeDropdown = document.getElementById("expense_type");

      // Clear existing options
      expenseTypeDropdown.innerHTML = '<option value="">Select</option>';

      // Sort data by expense_name in ascending order
      data.sort((a, b) => a.expense_name.localeCompare(b.expense_name));

      // Populate dropdown with sorted data
      data.forEach((expense) => {
        const option = document.createElement("option");
        option.value = expense.expense_id;
        option.textContent = expense.expense_name;
        expenseTypeDropdown.appendChild(option);
      });
    })
    .catch((error) => console.error("Error fetching expense types:", error));

  // Handle button click
  const addExpenseButton = document.getElementById("addExpenseButton");
  addExpenseButton.addEventListener("click", function () {
    const form = document.getElementById("addExpenseForm");
    const formData = new FormData(form);

    // Debug: Log all form data for verification
    for (let [key, value] of formData.entries()) {
      console.log(`${key}: ${value}`);
    }

    // Send POST request with form data
    fetch("http://localhost:5000/api/addExpense", {
      method: "POST",
      body: formData, // Pass FormData directly
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error("Network response was not ok " + response.statusText);
        }
        return response.json();
      })
      .then((result) => {
        console.log("Expense added successfully:", result);
        alert("Expense added successfully!");
        form.reset(); // Clear the form after successful submission
      })
      .catch((error) => {
        console.error("Error posting expense:", error);
        alert("Failed to add expense. Please try again.");
      });
  });
});
      </script>
      <script src="../../assets/js/region.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
    <%- include('../partials/footer') %>